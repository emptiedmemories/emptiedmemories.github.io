(function(){var t,i,e=function(t,i){return function(){return t.apply(i,arguments)}};t=!0,i=function(i){return t&&console.log(i)},$.fn.extend({changeClass:function(t,i){var e;return e=$(this),e.removeClass(t).addClass(i)},fixedX:function(){var t,i;return i=$(this),t=parseInt(i.css("left")),$(window).scroll(function(){return i.css({left:$(this).scrollLeft()+t})})},gallerize:function(t){return window.leave=!1,this.each(function(i,e){var s,n,o,a,h,r;return r=$(e),s=r.children("img"),s.length||(s=r.children("li")),h=s.length,n=0,o=t||1e3,s.eq(n).addClass("active"),a=function(){return window.leave?void 0:(s.removeClass("active"),n=h-1>n?n+1:0,s.eq(n).addClass("active"),setTimeout(a,o))},setTimeout(a,o)})}}),window.Site=function(){function t(){this.leave=e(this.leave,this),this.startLoadingImage=e(this.startLoadingImage,this),this.loadContent=e(this.loadContent,this),this.popState=e(this.popState,this),this.firstPop=e(this.firstPop,this),this.resize=e(this.resize,this),this.changeLang=e(this.changeLang,this),this.playVideo=e(this.playVideo,this),this.disableHover=e(this.disableHover,this),this.checkCountry=e(this.checkCountry,this)}return t.prototype.constuctor=function(){},t.prototype.setup=function(){return this.checkCountry(),this.prepare(),this.observe(),window.history&&history.pushState?this.firstPop():this.init()},t.prototype.prepare=function(){return this.window=$(window),this.document=$(document),this.html=$("html"),this.body=$("body"),this.main=this.body.find("main"),this.menu=this.body.find("#main-menu"),this.lang=this.body.find("#toggle-lang"),this.header=this.body.find("header"),this.loadedItem=this.body.find("#loaded-item"),this.totalItem=this.body.find("#total-item"),this.popped="state"in window.history&&null!=window.history.state,this.initialURL=location.href,this.introViewed=!1},t.prototype.checkCountry=function(){var t=this;return $.getJSON("http://api.wipmania.com/jsonp?callback=?",function(i){return t.is_china="China"===i.address.country})},t.prototype.observe=function(){return this.lang.on("click","a",this.changeLang),this.window.on({resize:this.resize,scroll:this.disableHover}),window.history&&history.pushState&&(window.onpopstate=this.popState,this.body.on("click","a:not('.download, .link, .video-link')",this.leave)),this.body.on("mouseover",'[rel="external"]',this.linkTo),this.body.on("click",".video-link",this.playVideo)},t.prototype.disableHover=function(){var t=this;return this.body.toggleClass("scrolled",this.window.scrollTop()>50),null!=this.timer&&(clearTimeout(this.timer),this.timer=null),this.body.addClass("disable-hover"),this.timer=setTimeout(function(){return t.body.removeClass("disable-hover")},500)},t.prototype.linkTo=function(t){return $(t.currentTarget).attr("target","_blank")},t.prototype.playVideo=function(t){var i;return i=$(t.currentTarget),this.is_china?void 0:(t.preventDefault(),new Player(i))},t.prototype.changeLang=function(t){var i,e;switch(e=$(t.currentTarget),i=e.data("lang"),this.lang.removeClass("unselected"),this.lang.find("a").removeClass("current"),e.addClass("current"),i){case"en":this.html.removeClass("lang-ch");break;case"ch":this.html.addClass("lang-ch")}return!1},t.prototype.init=function(){return this.is_home&&this["new"]("home"),this.is_panoramic&&this["new"]("panoramic"),this.is_panel&&this["new"]("panel"),this.is_gallery?this["new"]("gallery"):void 0},t.prototype.save_dimension=function(){return this.width=this.window.width(),this.height=this.window.height()},t.prototype.resize=function(){return this.save_dimension()},t.prototype.firstPop=function(){return this.initialPop=!this.popped&&location.href===this.initialURL,this.initialPop?(this.html.addClass("loading"),this.checkPage(),this.startLoadingImage()):void 0},t.prototype.popState=function(){return this.initialPop=!this.popped&&location.href===this.initialURL,this.popped=!0,this.initialPop?void 0:this.loadContent(location.pathname)},t.prototype.loadContent=function(t){var e=this;return this.loadedItem.add(this.totalItem).text(""),$.ajax({url:t}).fail(function(){return i("fail")}).done(function(t){var i,s,n,o,a;return t=$(t),n=t.find("main"),e.main.replaceWith(n),e.main=n,o=t.find("#main-menu"),e.menu.replaceWith(o),e.menu=o,e.body.attr("class","page-"+e.main.attr("data-slug")),e.checkPage(),e.is_video&&(s=e.main.find("article"),a=$(window).height(),i=s.height(),a>i&&s.css("top",(a-i)/2),e.scrollToMiddle()),e.startLoadingImage()})},t.prototype.checkPage=function(){return this.is_home=this.main.hasClass("home"),this.is_aboutEM=this.main.hasClass("about-emptied-memories"),this.is_panel=this.main.hasClass("about-panel"),this.is_panoramic=this.main.hasClass("about-panoramic"),this.is_artist=this.main.hasClass("artist"),this.is_gallery=this.main.hasClass("work-gallery"),this.is_video=this.main.hasClass("work-video"),this.is_echo=this.main.hasClass("echo"),this.is_contact=this.main.hasClass("contact"),this.is_book=this.main.hasClass("book")},t.prototype.startLoadingImage=function(){this.init(),this.html.removeClass("loading").addClass("loaded")},t.prototype.leave=function(t){var i,e,s=this;return e=$(t.currentTarget),i=e.attr("href"),window.leave=!0,this.is_home&&this.home.leave(),this.scrollToOrigin(function(){return s.loadContent(i),history.pushState("","New URL: "+i,i)}),t.preventDefault()},t.prototype.scrollToOrigin=function(t){var i,e;return i=dist(this.body.scrollTop(),this.body.scrollLeft(),0,0),e=1e5/i,e>1e3&&(e=1e3),0===i&&(e=0),this.body.animate({scrollTop:0,scrollLeft:0},e,t)},t.prototype.scrollToMiddle=function(){return this.body.animate({scrollTop:(this.body.height()-this.window.height())/2,scrollLeft:0},500)},t.prototype["new"]=function(t){var i;return i=t.charAt(0).toUpperCase()+t.slice(1),this[t]=new window[i]},t}(),window.site=new Site,site.setup()}).call(this);